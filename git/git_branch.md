## Git 分支

### 分支的概念
分支是在软件项目中启动一条单独的开发线的基本方法。分支是从一种统一的、原始的状态分离出来的，使开发能在多个方向上同时进行，并可能产生项目不同版本。通常情况下，分支会被调解并与其它分支合并，来重聚不同的力量。

### 使用分支的好处
* 一个分支通常代表一个单独的客户发布版。
* 一个分支可以封装一个开发阶段。
* 一个分支可以隔离一个特性的开发或者研究特别复杂的bug。
* 一个分支可以代表单个贡献者的工作。

>注意：分支和标签不用不同的目的。标签是一个静态的名字，它不随着时间的推移而改变。一旦应用，你不应该对它做任何动作。它相当于地上的一个支点和参考点。另一方面，分支是动态的，并且随着你的每次提交而移动。分支名用来跟随你的持续开发。

### 使用分支
版本库中默认分支命名为master，大多数开发人员在这个分支上保持版本库中最强大和最可靠的开发线。在Git初始化版本库的过程中就创建了这个master分支。  
在任何给定的时间里，版本库中可能有许多不同的分支，但最多只有一个当前的或者活动的分支。活动的分支决定在工作目录中检出哪些文件。此外，当前分支往往是Git命令中的隐含操作数，如合并操作的目标。默认情况下，master分支是活动分支，但可以把任何分支设置成当前分支。  
分支允许版本库中每个分支的内容向不同的方向发散。当一个版本库分出至少一个分支时，把每次提交应用到某个分支，取决于哪个分支时活动的。每个分支在一个特定的版本库中必须有唯一的名字，这个名字指向该分支上最近提交的版本。一个分支的最近提交称为该分支的头部。Git不会保存分支的起源信息。相反，分支名随着分支上新的提交而增量地向前移动。因此旧的提交必须通过散列值或一个相对名称（master~5）来选择。因为一个分支开始时的原始提交没有显示定义，所以这个提交可以使用从分叉出的新分支名和源分支名向后回退算法找到:
```
git merge-base original-branch new-branch
```

### 创建分支
新的分支基于版本库中现有的提交。完全由你来决定并指定哪次提交作为新分支的开始。创建分支命令的基本形式是：
```
git branch branch [starting-commit]
```
如果没有指定starting-commit,就默认为当前分支上的最近提交。也就是在你现在工作的地方启动一个新的分支。
>需要注意的是以上命令仅仅只是新建一个分支名，并没有使用该分支作为活动分支。

### 列出分支
git branch命令列出版本库中的分支名。如果没有额外的参数，则只列出版本库中的特性分支。可以使用-r列出那些远程分支。也可以使用-a选项把特性分支和远程分支都列出来。

### 查看分支
git show-branch命令提供比git branch更为详细的输出，按时间以递序的形式列出对一个或多个分支有贡献的提交。
```
! [alt] Z
 ! [dev] delete F on branch dev
  * [master] delete F on branch dev
---
 +* [dev] delete F on branch dev
 +* [dev^] F
 -- [dev~2] All lines
++* [alt] Z
```
输出分成两部分，上半部分每行代表一个分支，！开头的代表特性分支，\* 开头的代表当前活动分支，[]内是每个分支的名字，后面跟着提交信息的第一行；下半部分表示每个分支的提交矩阵，表示方式与上部分相似，就是前面的符号不一样，+表示这行提交在对应上部分的分支中，-表示合并提交， \* 突出显示存在当前活动分支。当调用git show-branch遍历所有显示分支上的提交，在它们最近的共同提交处停止，如果由于某种原因，你想要更多提交历史记录，使用--more=num选项，指定你想在共同提交后看到多少个额外的提交。

### 检出分支
工作目录一次只能反映一个分支，要在不同的分支上开始工作，要发出git checkout命令，给定一个分支名，git checkout会使该分支变成新的当前分支。它改变了工作树文件和目录结构来匹配给定分支的状态。有未提交的更改时进行检出，如果一个文件的本地修改与新分支上的变更有冲突时，Git会发出警告，并拒绝检出目标分支。如果你想把这个修改应用到新的分支上，就需要一个合并来将工作目录中的改变加入到新的工作目录中。使用-m选项特别要求，Git通过在你的本地修改和检出分支之间进行一次合并操作，尝试加入你的本地修改。如果Git可以检出一个分支，改变它，并且在没有任何合并冲突的情况下清晰地合并本地修改，那么检出请求就成功了。另一种情况是当你想创建一个新的分支并同时切换到它。Git提供了一个快捷方式-b new-branch选项来处理这种情况。命令：
```
git checkout -b new-branch start-point
```

### 分离HEAD分支
通常情况下，通过直接指出分支名来检出分支的头部是明智的。因此，默认情况下，git checkout会改变期望的分支头部。然而，可以检出任何提交。在这样的情况下，Git会创建一种匿名分支，成为一个分离的HEAD(detached HEAD)。在以下的情况下，Git会创建一个分离的HEAD：
* 检出的提交不是分支的头部
* 检出一个追踪分支。为了将基于文件标签的版本放在一起发布你可能会这样做。
* 检出标签引用的提交。为了将基于文件标签的版本放在一起发布你可能会这样做。
* 启动一个git bisect的操作。
* 使用git submodule update命令。  

如果你发现自己在一个分离的头部，同时你又在该点提交了新的变更，那么你必须在该点创建一个新的分支用于保留你的新提交。

